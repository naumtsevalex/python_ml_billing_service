# Changelog

## [Unreleased]

### Patch 4 
- Попытка пофиксить ошибки связанные с очередью? пофиксил 
- Дошел до вызова TTS и созранения - но потом ошибки полились которые поправил - теперь лог вообще пропал 
- как будто осталось прям совсем чут чуть

### Patch 3
- Весь проект переведён на единый файл `.env` с комментариями и разделами по сервисам. Удалён `envs.sh`, все переменные централизованы.
- Интеграция с RabbitMQ: реализованы две очереди (основная и reply_to), бот и воркер обмениваются задачами и результатами асинхронно.
- Введён синглтон для работы с базой данных во всех сервисах.
- Логирование действий теперь ведётся и в базу (таблица logs), и в stdout для удобства отладки.
- Все сервисы (бот, воркер, RabbitMQ, PostgreSQL, Prometheus, Grafana) запускаются одной командой через docker-compose, добавлены healthcheck и depends_on для корректного порядка запуска.
- Мониторинг (Prometheus, Grafana) только запущен, интеграция с метриками будет тестироваться далее.
- README.md обновлён: добавлены инструкции по запуску, настройке переменных окружения и миграциям.

### Patch 2
- Перепроектирована структура БД: теперь telegram_id — PRIMARY KEY для пользователей и внешний ключ для всех связанных таблиц (balances, logs, tasks, transactions).
- Полностью обновлены все модели ORM под новую схему (user, balance, transaction, task, log).
- Исправлены все обращения к user.id на user.telegram_id в коде бота и логирования.
- Проведена полная пересоздача миграций Alembic и очистка базы для корректной работы с новой схемой.
- Реализовано логирование действий пользователя (регистрация, старт, любое сообщение) в таблицу logs.
- Бот теперь использует telegram_id как основной идентификатор пользователя во всех операциях.
- Все параметры (токены, строки подключения) берутся из переменных окружения через envs.sh.
- Реализован и протестирован эхо-бот в Telegram: бот отвечает на текстовые сообщения, регистрирует пользователей и логирует действия.
- Проверена и подтверждена корректная работа регистрации, логирования и взаимодействия с базой.

### Patch 1
- Инициализирован проект.
- Добавлен docker-compose.yml с сервисами: rabbitmq, postgres, prometheus, grafana.
- Создана базовая структура для мониторинга (monitoring/prometheus.yml).
- Описаны модели данных через SQLAlchemy ORM (users, balances, transactions, tasks, logs).
- Настроен Alembic для автоматических миграций.
- Выполнена первая миграция — все таблицы созданы в PostgreSQL. 