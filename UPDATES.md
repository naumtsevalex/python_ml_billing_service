# UPDATES.md

## 2024-05-XX

### Patch 2
- Перепроектирована структура БД: теперь telegram_id — PRIMARY KEY для пользователей и внешний ключ для всех связанных таблиц (balances, logs, tasks, transactions).
- Полностью обновлены все модели ORM под новую схему (user, balance, transaction, task, log).
- Исправлены все обращения к user.id на user.telegram_id в коде бота и логирования.
- Проведена полная пересоздача миграций Alembic и очистка базы для корректной работы с новой схемой.
- Реализовано логирование действий пользователя (регистрация, старт, любое сообщение) в таблицу logs.
- Бот теперь использует telegram_id как основной идентификатор пользователя во всех операциях.
- Все параметры (токены, строки подключения) берутся из переменных окружения через envs.sh.
- Реализован и протестирован эхо-бот в Telegram: бот отвечает на текстовые сообщения, регистрирует пользователей и логирует действия.
- Проверена и подтверждена корректная работа регистрации, логирования и взаимодействия с базой.

### Patch 1
- Инициализирован проект.
- Добавлен docker-compose.yml с сервисами: rabbitmq, postgres, prometheus, grafana.
- Создана базовая структура для мониторинга (monitoring/prometheus.yml).
- Описаны модели данных через SQLAlchemy ORM (users, balances, transactions, tasks, logs).
- Настроен Alembic для автоматических миграций.
- Выполнена первая миграция — все таблицы созданы в PostgreSQL.